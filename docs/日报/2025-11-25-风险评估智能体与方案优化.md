# 工作日报 - 2025年11月25日

## 一、上午工作（9:00 - 12:00）

### 1.1 SSW项目会议

参加SSW项目技术评审会议，汇报24号晚间开发的HTN分层任务网络算法模块，讨论后续开发计划和技术方案。

---

## 二、下午工作（14:00 - 18:00）

### 2.1 救援方案生成智能体问题排查

对EmergencyAI智能体进行问题排查和调试：
- 分析前一天开发的HTN任务分解模块与后续节点的衔接问题
- 排查资源匹配节点的数据传递异常
- 梳理整体流程的状态流转逻辑

### 2.2 需求分析与方案设计

- 分析实时风险评估的业务需求，设计技术方案
- 确定风险评估的多维度因素：气象、灾害proximity、作业类型
- 设计LangGraph流程图架构，规划节点划分

---

## 三、晚间加班（18:00 - 次日01:30）

### 3.1 实时风险评估智能体开发（18:00 - 23:00）

基于LangGraph框架，开发实时风险评估智能体（RealTimeRiskAgent），实现救援过程中的动态风险监测与预警。

#### 3.1.1 路径风险预测模块

开发队伍行进路径的实时风险评估功能：

| 功能 | 说明 |
|------|------|
| 气象风险评估 | 对接气象服务获取未来N小时气象预报，评估风速、降水对行进的影响 |
| 灾害proximity分析 | 计算队伍与灾害中心的距离，评估接近灾害区域的风险等级 |
| 多因素综合评估 | 综合气象、灾害、路况等因素，计算综合风险等级（红/橙/黄/蓝四级） |
| 风险因素追溯 | 详细记录每个风险因素的类型、等级、数值和描述，支持决策解释 |

**风险等级判定逻辑**：
- 红色预警：距灾害中心<1km 或 极端气象条件
- 橙色预警：距灾害中心1-3km 或 恶劣气象条件
- 黄色预警：距灾害中心3-5km 或 不利气象条件
- 蓝色提示：无明显风险

#### 3.1.2 作业风险评估模块

开发现场救援作业的实时风险评估功能：

| 功能 | 说明 |
|------|------|
| 气象实时监测 | 获取作业点当前气象数据，评估风速、降水对作业安全的影响 |
| 灾害次生风险 | 根据灾害类型评估次生灾害风险（余震、燃烧蔓延、化学品扩散等） |
| 作业类型固有风险 | 根据作业类型评估固有风险（密闭空间、高温暴露、高空作业等） |
| 安全建议生成 | 根据风险等级自动生成针对性的安全建议和防护措施 |

**作业类型风险映射**：

| 作业类型 | 风险因素 | 基础等级 |
|----------|----------|----------|
| rescue（搜救） | 密闭空间作业风险 | 黄色 |
| firefighting（灭火） | 高温暴露风险 | 橙色 |
| hazmat（危化品） | 化学品接触风险 | 红色 |
| height_work（高空） | 高空坠落风险 | 橙色 |
| demolition（破拆） | 结构坍塌风险 | 橙色 |

#### 3.1.3 智能体流程图实现

设计并实现预警监测智能体的LangGraph流程：

```
预警流程：ingest → analyze → decide → generate → notify
                                                    │
                                                    ▼ (需要预测?)
预测流程：predict_path_risk → predict_operation_risk → predict_disaster_spread
                                                                    │
                                                                    ▼ (需要审核?)
                                                              human_review → END
```

**关键设计**：
- 支持人工审核介入：红色预警自动触发人工审核流程
- 支持独立预测模式：可单独调用风险预测功能，不走完整预警流程
- 置信度计算：综合气象数据可用性、灾害态势信息、路况信息计算预测置信度

---

### 3.2 救援方案生成智能体优化（23:00 - 01:30）

对EmergencyAI智能体进行深度优化，提升方案生成质量。

#### 3.2.1 五维评估体系优化

优化方案评分的五维评估体系，严格对齐军事版标准：

| 维度 | 权重 | 计算方法 |
|------|------|----------|
| 成功率 | 35% | 0.6×历史案例成功率 + 0.4×能力匹配度 |
| 响应时间 | 30% | max(0, 1 - 响应时间/120分钟) |
| 覆盖率 | 20% | 关键能力覆盖率 |
| 风险 | 5% | 1 - 救援人员风险等级 |
| 冗余性 | 10% | 有备用覆盖的能力比例 |

**灾害类型差异化权重**：
- 地震：响应时间权重提升至35%（黄金72小时）
- 火灾：响应时间权重提升至40%（火势蔓延快）

#### 3.2.2 硬规则过滤优化

优化硬规则一票否决机制：

| 规则ID | 规则名称 | 阈值 | 说明 |
|--------|----------|------|------|
| HR-EM-001 | 救援人员安全红线 | 风险≤15% | 救援人员伤亡风险超限则否决 |
| HR-EM-002 | 黄金救援时间 | ≤180分钟 | 响应时间超过3小时则否决 |
| HR-EM-003 | 关键能力覆盖 | ≥70% | 能力覆盖率不足则否决 |
| HR-EM-004 | 救援容量底线 | ≥50% | 资源严重不足需紧急增援 |

#### 3.2.3 巨灾模式处理

新增巨灾场景特殊处理逻辑：

当所有方案都被硬规则否决时（特大灾害、资源严重不足），系统不再简单报错，而是：
1. 启用巨灾模式，选择救援容量最大的方案作为首批先遣力量
2. 自动计算救援容量缺口，生成增援需求建议
3. 根据容量缺口比例推荐增援级别（市级/省级/国家级）
4. 为指挥员生成详细的增援建议和协调要点

**增援级别判定**：
- 容量覆盖<30%：国家级增援（请求国家救援队、武警部队）
- 容量覆盖30-50%：省级增援（请求省级专业救援队）
- 容量覆盖50-70%：市级增援（向市级应急指挥部申请）

#### 3.2.4 冗余性评估算法

实现资源冗余性评估算法：

```
冗余性 = (能力冗余率 + 队伍冗余率) / 2

能力冗余率 = 有≥2个资源覆盖的能力数 / 总能力需求数
队伍冗余率 = min(1.0, 实际队伍数 / (最小需求队伍数 × 1.5))
```

---

## 四、今日产出

| 模块 | 文件 | 功能 |
|------|------|------|
| 路径风险预测 | `predict_path_risk.py` | 队伍行进路径的实时风险评估 |
| 作业风险评估 | `predict_operation_risk.py` | 现场救援作业的风险评估 |
| 智能体流程图 | `graph.py` | 预警监测+风险预测的LangGraph流程 |
| 方案优化 | `optimization.py` | 五维评估、硬规则过滤、巨灾模式 |
| 成功率计算 | `_calculate_success_rate()` | 基于历史案例的成功率预测 |
| 冗余性计算 | `_calculate_redundancy_rate()` | 资源冗余性评估算法 |

---

## 五、工作时长

- 上午会议：9:00 - 12:00（3小时）
- 下午调试：14:00 - 18:00（4小时）
- 晚间开发：18:00 - 01:30（7.5小时）
- **合计：14.5小时**

---

*报告人：马圣权*
*日期：2025年11月25日*
