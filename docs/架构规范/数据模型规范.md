# 数据模型规范

本文档定义项目中关键数据模型的标准，确保各模块使用一致的单位和类型。

## 1. 坡度（Slope/Gradient）

### 规范
- **统一单位**: 百分比（%）
- **字段命名**: `*_percent` 或 `*_gradient_percent`
- **数据类型**: `float` 或 `int`

### 说明
坡度百分比 = tan(角度) × 100

| 百分比 | 角度 | 说明 |
|--------|------|------|
| 5% | 2.9° | 普通道路 |
| 10% | 5.7° | 山区公路 |
| 15% | 8.5° | 陡坡公路 |
| 30% | 16.7° | 越野道路 |
| 100% | 45° | 极限坡度 |

### 代码示例
```python
from src.planning.algorithms.routing.types import (
    slope_deg_to_percent,
    slope_percent_to_deg,
)

# 角度转百分比
slope_percent = slope_deg_to_percent(10.0)  # 10° → 17.6%

# 百分比转角度
slope_deg = slope_percent_to_deg(30.0)  # 30% → 16.7°
```

### 相关字段
| 位置 | 字段名 | 单位 |
|------|--------|------|
| `road_edges_v2` 表 | `max_gradient_percent` | % |
| `road_edges_v2` 表 | `avg_gradient_percent` | % |
| `VehicleCapability` | `max_gradient_percent` | % |
| `CapabilityMetrics` | `slope_percent` | % |

---

## 2. 车辆能力参数

### 主模型：VehicleCapability
用于数据库实体，完整参数。

```python
@dataclass
class VehicleCapability:
    code: str                           # 车辆编码
    max_speed_kmh: int                  # 最大速度 km/h
    is_all_terrain: bool                # 是否全地形
    terrain_capabilities: List[str]     # 支持的地形类型
    terrain_speed_factors: Dict[str, float]  # 地形速度系数
    max_gradient_percent: Optional[int] # 最大爬坡能力 %
    max_wading_depth_m: Optional[float] # 最大涉水深度 m
    width_m: Optional[float]            # 车宽 m
    height_m: Optional[float]           # 车高 m
    self_weight_kg: Optional[float]     # 自重 kg
    max_weight_kg: Optional[float]      # 最大载重 kg
```

### 轻量模型：CapabilityMetrics
用于算法接口，简化参数。

```python
class CapabilityMetrics(BaseModel):
    width_m: Optional[float]            # 车宽 m
    height_m: Optional[float]           # 车高 m
    weight_kg: Optional[float]          # 重量 kg
    slope_percent: Optional[float]      # 爬坡能力 %
    wading_depth_m: Optional[float]     # 涉水深度 m
    # ... 其他参数
```

### 使用场景
- **数据库查询** → 使用 `VehicleCapability`
- **算法接口** → 使用 `CapabilityMetrics`

---

## 3. 距离和长度

### 规范
| 场景 | 单位 | 字段后缀 |
|------|------|----------|
| 短距离（车宽、涉水深度） | 米 | `_m` |
| 长距离（路径长度） | 米 | `_m` |
| 行驶里程 | 公里 | `_km` |

### 示例
```python
width_m: float          # 车宽，米
distance_m: float       # 路径长度，米
range_km: float         # 续航里程，公里
```

---

## 4. 时间

### 规范
| 场景 | 单位 | 字段后缀 |
|------|------|----------|
| 短时间（响应延迟） | 毫秒 | `_ms` |
| 中等时间（行驶时间） | 秒 | `_s` |
| 长时间（续航时间） | 分钟 | `_min` |

### 示例
```python
elapsed_ms: float       # 计算耗时，毫秒
duration_s: float       # 行驶时间，秒
endurance_min: float    # 续航时间，分钟
```

---

## 5. 速度

### 规范
- **车辆速度**: km/h，字段后缀 `_kmh`
- **风速**: m/s，字段后缀 `_mps`

### 示例
```python
max_speed_kmh: int      # 最大速度，km/h
max_wind_mps: float     # 最大抗风，m/s
```

---

## 6. 地形类型

### 标准值
```python
TERRAIN_TYPES = [
    "urban",        # 城市
    "suburban",     # 郊区
    "rural",        # 乡村
    "mountain",     # 山区
    "forest",       # 森林
    "grassland",    # 草地
    "wetland",      # 湿地
    "desert",       # 沙漠
    "water_adjacent",  # 临水
    "unknown",      # 未知
]
```

### 地形速度系数
```python
TERRAIN_SPEED_FACTORS = {
    "urban": 1.0,
    "suburban": 0.9,
    "rural": 0.85,
    "mountain": 0.6,
    "forest": 0.5,
    "grassland": 0.7,
    "wetland": 0.3,
    "desert": 0.7,
    "water_adjacent": 0.4,
    "unknown": 0.8,
}
```
