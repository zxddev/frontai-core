# 操作手册业务接口设计

> 版本: 2.1  
> 创建时间: 2025-11-25  
> 更新时间: 2025-11-25  
> 优先级: P1

---

## 一、模块概述

操作手册业务模块覆盖完整的救援作业流程，从接收通报到救援评估。按照标准救援流程分为五个阶段。

**五阶段救援流程：**
```
接收通报 → 应急准备 → 机动前出 → 灾情侦察 → 救援指挥 → 总结评估
```

**模块架构说明：**
- 所有救援流程接口统一在 `/api/v2/rescue-workflow` 路径下
- AI方案生成复用 `/api/v2/ai/generate-scheme`，通过 scheme_type 区分类型
- 手册基础CRUD由基础数据平台提供

---

## 二、接口总览

| 阶段 | 接口数 | 说明 |
|------|--------|------|
| 一、应急响应与准备 | 5 | 接收通报→装备准备→出发 |
| 二、机动前出 | 5 | 路径规划→风险预测→安全点 |
| 三、灾情快速侦察 | 6 | 指挥所→无人机集群→救援点识别 |
| 四、应急救援指挥 | 4 | 救援点管理→协调联络 |
| 五、救援总结评估 | 2 | 评估报告生成与查询 |
| 六、手册查询 | 2 | 手册推荐与搜索 |

**总计: 24个接口**

---

## 三、阶段一：应急响应与准备

### 3.1 接口列表

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 接收突发事件通报 | POST | `/api/v2/rescue-workflow/incidents/receive` | 接收后方通报 |
| AI装备建议 | POST | `/api/v2/rescue-workflow/incidents/equipment-suggestion` | AI推荐装备物资 |
| 下发准备任务 | POST | `/api/v2/rescue-workflow/incidents/{event_id}/preparation-tasks` | 下发装备准备任务 |
| 提交准备完成 | POST | `/api/v2/rescue-workflow/incidents/preparation-tasks/{id}/complete` | 各车提交准备完成 |
| 下发出发指令 | POST | `/api/v2/rescue-workflow/incidents/depart-command` | 下发车辆出发指令 |

### 3.2 接口详细设计

#### 3.2.1 接收突发事件通报

**POST** `/api/v2/rescue-workflow/incidents/receive`

**请求体：**
```json
{
    "scenario_id": "scenario-uuid",
    "incident_type": "earthquake",
    "incident_level": "II",
    "location": {
        "province": "四川省",
        "city": "阿坝州",
        "district": "茂县",
        "address": "凤仪镇",
        "coordinates": {"longitude": 103.85, "latitude": 31.68}
    },
    "description": "发生6.8级地震，多处建筑倒塌",
    "estimated_victims": 500,
    "source": "省应急指挥中心",
    "notified_at": "2025-11-25T14:30:00+08:00"
}
```

**响应体：**
```json
{
    "success": true,
    "data": {
        "notification_id": "notif-uuid",
        "scenario_id": "scenario-uuid",
        "status": "received",
        "auto_actions": [
            "已创建想定",
            "已触发AI装备建议生成"
        ],
        "next_step": "等待AI装备建议后下发准备任务"
    }
}
```

---

#### 3.2.2 AI装备建议

**POST** `/api/v2/rescue-workflow/incidents/equipment-suggestion`

**请求体：**
```json
{
    "event_id": "event-uuid",
    "scenario_id": "scenario-uuid",
    "incident_type": "earthquake",
    "incident_level": "II",
    "estimated_victims": 500
}
```

**响应体：**
```json
{
    "success": true,
    "data": {
        "suggestion_id": "sug-uuid",
        "incident_type": "earthquake",
        "recommended_equipment": {
            "rescue_tools": [
                {"name": "液压破拆工具组", "quantity": 4, "priority": "必需"},
                {"name": "生命探测仪", "quantity": 2, "priority": "必需"},
                {"name": "切割机", "quantity": 3, "priority": "必需"}
            ],
            "medical_supplies": [
                {"name": "急救包", "quantity": 50, "priority": "必需"},
                {"name": "担架", "quantity": 20, "priority": "必需"},
                {"name": "夹板", "quantity": 30, "priority": "推荐"}
            ],
            "communication": [
                {"name": "卫星电话", "quantity": 5, "priority": "必需"},
                {"name": "对讲机", "quantity": 30, "priority": "必需"}
            ],
            "uav_devices": [
                {"name": "侦察无人机", "quantity": 4, "priority": "必需"},
                {"name": "热成像无人机", "quantity": 2, "priority": "推荐"}
            ]
        },
        "vehicle_allocation": [
            {"vehicle_type": "指挥车", "count": 1, "equipment": ["通信设备", "指挥系统"]},
            {"vehicle_type": "救援车", "count": 3, "equipment": ["破拆工具", "搜救设备"]},
            {"vehicle_type": "医疗车", "count": 2, "equipment": ["医疗物资", "急救设备"]}
        ],
        "ai_rationale": "基于6.8级地震和预估500人被困，建议配置重型破拆设备...",
        "reference_cases": ["2017茂县滑坡", "2013芦山地震"]
    }
}
```

---

#### 3.2.3 下发准备任务

**POST** `/api/v2/rescue-workflow/incidents/{event_id}/preparation-tasks`

**请求体：**
```json
{
    "scenario_id": "scenario-uuid",
    "suggestion_id": "sug-uuid",
    "tasks": [
        {
            "vehicle_id": "vehicle-001",
            "vehicle_name": "指挥车1号",
            "equipment_list": [
                {"name": "卫星电话", "quantity": 2},
                {"name": "指挥终端", "quantity": 1}
            ],
            "personnel_required": 5,
            "deadline_minutes": 30
        },
        {
            "vehicle_id": "vehicle-002",
            "vehicle_name": "救援车A",
            "equipment_list": [
                {"name": "液压破拆工具组", "quantity": 2},
                {"name": "生命探测仪", "quantity": 1}
            ],
            "personnel_required": 12,
            "deadline_minutes": 30
        }
    ]
}
```

**响应体：**
```json
{
    "success": true,
    "data": {
        "batch_id": "batch-uuid",
        "tasks_created": 2,
        "tasks": [
            {"task_id": "prep-001", "vehicle_id": "vehicle-001", "status": "pending"},
            {"task_id": "prep-002", "vehicle_id": "vehicle-002", "status": "pending"}
        ],
        "overall_deadline": "2025-11-25T15:00:00+08:00"
    }
}
```

---

#### 3.2.4 提交准备完成

> **实现状态**: 待实现

**POST** `/api/v2/rescue-workflow/incidents/preparation-tasks/{id}/complete`

**请求体：**
```json
{
    "completed_items": [
        {"name": "液压破拆工具组", "actual_quantity": 2, "status": "ok"},
        {"name": "生命探测仪", "actual_quantity": 1, "status": "ok"}
    ],
    "personnel_onboard": 12,
    "fuel_level": 95,
    "notes": "全部装备已就位，人员到齐"
}
```

**响应体：**
```json
{
    "success": true,
    "data": {
        "task_id": "prep-002",
        "status": "completed",
        "completed_at": "2025-11-25T14:55:00+08:00",
        "batch_progress": {
            "total": 6,
            "completed": 4,
            "pending": 2
        }
    }
}
```

---

#### 3.2.5 下发出发指令

**POST** `/api/v2/rescue-workflow/incidents/depart-command`

**请求体：**
```json
{
    "scenario_id": "scenario-uuid",
    "vehicle_ids": ["vehicle-001", "vehicle-002", "vehicle-003"],
    "destination": {
        "name": "茂县凤仪镇集结点",
        "coordinates": {"longitude": 103.85, "latitude": 31.68}
    },
    "formation": "convoy",
    "departure_time": "2025-11-25T15:00:00+08:00",
    "route_preference": "fastest"
}
```

**响应体：**
```json
{
    "success": true,
    "data": {
        "command_id": "cmd-uuid",
        "vehicles_notified": 3,
        "estimated_arrival": "2025-11-25T17:30:00+08:00",
        "distance_km": 85,
        "routes_generated": true
    }
}
```

---

## 四、阶段二：机动前出

### 4.1 接口列表

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| AI路径导航 | POST | `/api/v2/rescue-workflow/navigation/route` | AI智能路径规划 |
| 切换导航路线 | POST | `/api/v2/rescue-workflow/navigation/route/{route_id}/switch` | 切换到备选路线 |
| 风险预测 | GET | `/api/v2/rescue-workflow/navigation/{event_id}/risks` | 行进风险预测 |
| 获取安全点 | GET | `/api/v2/rescue-workflow/navigation/{event_id}/safe-points` | 获取沿途安全点 |
| 安全点确认 | POST | `/api/v2/rescue-workflow/navigation/safe-points/confirm` | 确认安全停靠点 |

### 4.2 接口详细设计

#### 4.2.1 AI路径导航

**POST** `/api/v2/rescue-workflow/navigation/route`

**请求体：**
```json
{
    "scenario_id": "scenario-uuid",
    "vehicle_id": "vehicle-001",
    "origin": {"longitude": 104.06, "latitude": 30.67},
    "destination": {"longitude": 103.85, "latitude": 31.68},
    "preferences": {
        "avoid_highways": false,
        "avoid_tolls": false,
        "consider_road_damage": true
    }
}
```

**响应体：**
```json
{
    "success": true,
    "data": {
        "route_id": "route-uuid",
        "primary_route": {
            "distance_km": 85,
            "estimated_time_min": 150,
            "waypoints": [
                {"lng": 104.06, "lat": 30.67, "name": "起点-成都"},
                {"lng": 103.95, "lat": 31.20, "name": "途经-都江堰"},
                {"lng": 103.85, "lat": 31.68, "name": "终点-茂县"}
            ],
            "road_conditions": [
                {"segment": "成都-都江堰", "status": "good", "note": "高速畅通"},
                {"segment": "都江堰-茂县", "status": "caution", "note": "山路弯多，注意落石"}
            ],
            "risk_level": "medium"
        },
        "alternative_routes": [
            {
                "name": "备选路线-绕行绵阳",
                "distance_km": 120,
                "estimated_time_min": 180,
                "risk_level": "low",
                "reason": "避开震区主要道路"
            }
        ],
        "safe_points": [
            {"lng": 103.95, "lat": 31.20, "name": "都江堰服务区", "facilities": ["加油", "休息"]}
        ]
    }
}
```

---

#### 4.2.2 切换导航路线

**POST** `/api/v2/rescue-workflow/navigation/route/{route_id}/switch`

**查询参数：**
| 参数 | 类型 | 说明 |
|------|------|------|
| new_route_index | int | 备选路径索引 |

**请求体（可选）：**
```json
{
    "reason": "主路线前方发生塌方"
}
```

---

#### 4.2.3 风险预测

**GET** `/api/v2/rescue-workflow/navigation/{event_id}/risks`

**查询参数：**
| 参数 | 类型 | 说明 |
|------|------|------|
| min_lng | float | 区域最小经度 |
| min_lat | float | 区域最小纬度 |
| max_lng | float | 区域最大经度 |
| max_lat | float | 区域最大纬度 |

**响应体：**
```json
{
    "success": true,
    "data": {
        "current_segment": "都江堰-茂县",
        "risks": [
            {
                "type": "landslide",
                "probability": 0.35,
                "location": {"lng": 103.88, "lat": 31.45},
                "description": "前方5km处有滑坡风险区",
                "recommendation": "减速慢行，保持车距"
            },
            {
                "type": "aftershock",
                "probability": 0.15,
                "description": "可能发生4.0级以下余震",
                "recommendation": "注意路边避险"
            }
        ],
        "weather": {
            "condition": "cloudy",
            "visibility_km": 8,
            "rain_probability": 0.2
        },
        "overall_risk": "medium",
        "next_safe_point_km": 12
    }
}
```

---

#### 4.2.4 获取安全点

**GET** `/api/v2/rescue-workflow/navigation/{event_id}/safe-points`

**查询参数：**
| 参数 | 类型 | 说明 |
|------|------|------|
| route_id | UUID | 路线ID |

**响应体：**
```json
{
    "success": true,
    "data": [
        {
            "point_id": "sp-uuid",
            "location": {"longitude": 103.95, "latitude": 31.20},
            "name": "都江堰服务区",
            "type": "rest_stop",
            "facilities": ["加油", "休息", "餐饮"],
            "distance_from_start_km": 35
        }
    ]
}
```

---

#### 4.2.5 安全点确认

**POST** `/api/v2/rescue-workflow/navigation/safe-points/confirm`

**请求体：**
```json
{
    "point_id": "sp-uuid",
    "scenario_id": "scenario-uuid",
    "vehicle_id": "vehicle-001",
    "action": "arrived",
    "status_report": {
        "personnel_status": "all_ok",
        "vehicle_status": "ok",
        "fuel_level": 70,
        "notes": "短暂休整，10分钟后继续"
    }
}
```

**响应体：**
```json
{
    "success": true,
    "data": {
        "point_id": "sp-uuid",
        "confirmed": true,
        "confirmed_at": "2025-11-25T16:30:00+08:00"
    }
}
```

---

## 五、阶段三：灾情快速侦察

### 5.1 接口列表

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| AI临时指挥所推荐 | GET | `/api/v2/rescue-workflow/command/{event_id}/post-recommendation` | 推荐指挥所位置 |
| 确认临时指挥所 | POST | `/api/v2/rescue-workflow/command/post/confirm` | 确认指挥所位置 |
| 无人装备集群管控 | POST | `/api/v2/rescue-workflow/command/uav-cluster` | 集群控制指令 |
| 救援点AI识别(触发) | POST | `/api/v2/rescue-workflow/command/rescue-detections/trigger` | 触发AI识别救援点 |
| 救援点AI识别(查询) | GET | `/api/v2/rescue-workflow/command/{event_id}/rescue-detections` | 查询AI识别结果 |
| 确认救援点 | POST | `/api/v2/rescue-workflow/command/rescue-detections/confirm` | 确认识别的救援点 |

**复用接口：**
- AI侦察方案生成: `POST /api/v2/ai/generate-scheme` (scheme_type=reconnaissance)

### 5.2 接口详细设计

#### 5.2.1 AI临时指挥所推荐

**GET** `/api/v2/rescue-workflow/command/{event_id}/post-recommendation`

**查询参数：**
| 参数 | 类型 | 说明 |
|------|------|------|
| current_location | string | 当前位置 lng,lat (可选) |
| affected_area | string | 影响区域边界 (可选) |

**响应体：**
```json
{
    "success": true,
    "data": {
        "recommendations": [
            {
                "rank": 1,
                "location": {"longitude": 103.86, "latitude": 31.70},
                "name": "凤仪镇政府广场",
                "score": 0.92,
                "advantages": [
                    "地势开阔，便于车辆集结",
                    "距离主要灾区2km，安全且便捷",
                    "有基础设施可用"
                ],
                "disadvantages": ["通信信号较弱"],
                "distance_to_affected_km": 2.0
            },
            {
                "rank": 2,
                "location": {"longitude": 103.88, "latitude": 31.72},
                "name": "茂县中学操场",
                "score": 0.85,
                "advantages": ["场地大", "有水电"],
                "disadvantages": ["距离稍远"],
                "distance_to_affected_km": 4.5
            }
        ]
    }
}
```

---

#### 5.2.2 确认临时指挥所

**POST** `/api/v2/rescue-workflow/command/post/confirm`

**请求体：**
```json
{
    "scenario_id": "scenario-uuid",
    "location": {"longitude": 103.86, "latitude": 31.70},
    "name": "凤仪镇前线指挥所",
    "commander": "user-001",
    "communication_channels": {
        "satellite_phone": "13800138001",
        "radio_frequency": "150.5MHz"
    },
    "established_at": "2025-11-25T17:30:00+08:00"
}
```

**响应体：**
```json
{
    "success": true,
    "data": {
        "command_post_id": "cp-uuid",
        "status": "established",
        "entity_id": "entity-uuid",
        "broadcast_sent": true
    }
}
```

---

#### 5.2.3 无人装备集群管控

**POST** `/api/v2/rescue-workflow/command/uav-cluster`

**请求体：**
```json
{
    "scenario_id": "scenario-uuid",
    "command_type": "deploy_reconnaissance",
    "devices": [
        {"device_id": "uav-001", "role": "lead"},
        {"device_id": "uav-002", "role": "follower"},
        {"device_id": "uav-003", "role": "follower"},
        {"device_id": "robot-001", "role": "ground_support"}
    ],
    "mission": {
        "type": "area_scan",
        "target_area": {
            "type": "Polygon",
            "coordinates": [[[103.84, 31.67], [103.87, 31.67], [103.87, 31.70], [103.84, 31.70], [103.84, 31.67]]]
        },
        "altitude_m": 100,
        "scan_pattern": "grid",
        "sensors": ["rgb_camera", "thermal_camera", "lidar"]
    },
    "formation": "diamond",
    "return_on_low_battery": true
}
```

**响应体：**
```json
{
    "success": true,
    "data": {
        "mission_id": "mission-uuid",
        "devices_deployed": 4,
        "estimated_duration_min": 45,
        "coverage_area_km2": 1.5,
        "status": "in_progress"
    }
}
```

---

#### 5.2.4 救援点AI识别(触发)

> **实现状态**: 待实现

**POST** `/api/v2/rescue-workflow/command/rescue-detections/trigger`

**请求体：**
```json
{
    "scenario_id": "scenario-uuid",
    "event_id": "event-uuid",
    "mission_id": "mission-uuid",
    "detection_source": "uav_imagery",
    "image_urls": [
        "https://storage.example.com/imagery/scan-001.jpg",
        "https://storage.example.com/imagery/scan-002.jpg"
    ],
    "thermal_data": {
        "url": "https://storage.example.com/thermal/scan-001.dat",
        "anomalies": [
            {"location": {"lng": 103.851, "lat": 31.682}, "temperature_delta": 5.2}
        ]
    }
}
```

**响应体：**
```json
{
    "success": true,
    "data": {
        "detection_id": "det-uuid",
        "status": "processing",
        "estimated_completion_sec": 30
    }
}
```

---

#### 5.2.5 救援点AI识别(查询)

**GET** `/api/v2/rescue-workflow/command/{event_id}/rescue-detections`

**响应体：**
```json
{
    "success": true,
    "data": {
        "detection_id": "det-uuid",
        "detected_points": [
            {
                "id": "point-001",
                "location": {"longitude": 103.851, "latitude": 31.682},
                "type": "building_collapse",
                "confidence": 0.92,
                "estimated_victims": 15,
                "priority": "critical",
                "evidence": ["热成像异常", "建筑结构损毁"],
                "image_url": "https://storage.example.com/detections/point-001.jpg"
            },
            {
                "id": "point-002",
                "location": {"longitude": 103.855, "latitude": 31.685},
                "type": "road_damage",
                "confidence": 0.88,
                "priority": "high",
                "evidence": ["道路断裂", "车辆滞留"]
            }
        ],
        "total_detected": 2,
        "requires_confirmation": true
    }
}
```

---

#### 5.2.6 确认救援点

**POST** `/api/v2/rescue-workflow/command/rescue-detections/confirm`

**请求体：**
```json
{
    "scenario_id": "scenario-uuid",
    "detection_id": "det-uuid",
    "confirmed_points": [
        {
            "detected_point_id": "point-001",
            "confirmed": true,
            "adjusted_location": {"longitude": 103.851, "latitude": 31.6825},
            "adjusted_victims": 20,
            "notes": "现场确认，被困人数比AI识别更多"
        }
    ],
    "rejected_points": [
        {
            "detected_point_id": "point-002",
            "reason": "已由其他队伍处理"
        }
    ]
}
```

**响应体：**
```json
{
    "success": true,
    "data": {
        "confirmed": 1,
        "rejected": 1,
        "events_created": [
            {"event_id": "event-uuid", "rescue_point_id": "point-001"}
        ]
    }
}
```

---

## 六、阶段四：应急救援指挥

### 6.1 接口列表

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 新增救援点 | POST | `/api/v2/rescue-workflow/rescue/points` | 手动新增救援点 |
| 更新救援点 | PUT | `/api/v2/rescue-workflow/rescue/points/{point_id}` | 更新救援点状态 |
| 获取协同总览 | GET | `/api/v2/rescue-workflow/rescue/{event_id}/overview` | 救援点全景数据 |
| 更新协同状态 | POST | `/api/v2/rescue-workflow/rescue/coordination` | 更新协调进度 |

**复用接口：**
- AI总体救援方案: `POST /api/v2/ai/generate-scheme` (scheme_type=overall)
- AI一线救援方案: `POST /api/v2/ai/generate-scheme` (scheme_type=frontline)

### 6.2 接口详细设计

#### 6.2.1 新增救援点

**POST** `/api/v2/rescue-workflow/rescue/points`

**请求体：**
```json
{
    "scenario_id": "scenario-uuid",
    "name": "幸福路12号倒塌点",
    "location": {"longitude": 103.852, "latitude": 31.683},
    "type": "building_collapse",
    "priority": "critical",
    "estimated_victims": 25,
    "description": "5层居民楼整体倒塌",
    "hazards": ["次生火灾风险", "建筑不稳定"],
    "access_routes": ["从北侧可进入"],
    "reported_by": "user-001"
}
```

---

#### 6.2.2 更新救援点

**PUT** `/api/v2/rescue-workflow/rescue/points/{point_id}`

**请求体：**
```json
{
    "status": "in_progress",
    "rescued_count": 8,
    "notes": "正在救援第二名被困人员"
}
```

**响应体：**
```json
{
    "success": true,
    "data": {
        "id": "rp-001",
        "name": "幸福路12号",
        "status": "in_progress",
        "estimated_victims": 25,
        "rescued_count": 8,
        "remaining_victims": 17,
        "updated_at": "2025-11-25T18:30:00+08:00"
    }
}
```

---

#### 6.2.3 获取协同总览

**GET** `/api/v2/rescue-workflow/rescue/{event_id}/overview`

**响应体：**
```json
{
    "success": true,
    "data": {
        "scenario_id": "scenario-uuid",
        "summary": {
            "total_points": 8,
            "by_priority": {"critical": 2, "high": 3, "medium": 2, "low": 1},
            "by_status": {"pending": 2, "in_progress": 4, "resolved": 2},
            "total_estimated_victims": 150,
            "total_rescued": 45
        },
        "rescue_points": [
            {
                "id": "rp-001",
                "name": "幸福路12号",
                "location": {"longitude": 103.852, "latitude": 31.683},
                "priority": "critical",
                "status": "in_progress",
                "estimated_victims": 25,
                "rescued_count": 8,
                "assigned_teams": ["搜救一队", "搜救二队"],
                "progress_percentage": 32
            }
        ],
        "command_post": {
            "location": {"longitude": 103.86, "latitude": 31.70},
            "name": "前线指挥所"
        },
        "resource_deployment": {
            "teams_deployed": 6,
            "uavs_active": 4,
            "vehicles_on_site": 8
        }
    }
}
```

---

#### 6.2.4 更新协同状态

**POST** `/api/v2/rescue-workflow/rescue/coordination`

**请求体：**
```json
{
    "event_id": "event-uuid",
    "update_type": "team_arrived",
    "entity_id": "team-001",
    "entity_type": "team",
    "data": {
        "location": {"longitude": 103.852, "latitude": 31.683},
        "status": "on_site",
        "notes": "搜救一队已抵达幸福路12号救援点"
    }
}
```

**响应体：**
```json
{
    "success": true,
    "data": {
        "update_id": "upd-uuid",
        "status": "processed"
    }
}
```

---

## 七、阶段五：救援总结评估

### 7.1 接口列表

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 生成评估报告 | POST | `/api/v2/rescue-workflow/evaluation/generate` | 生成救援评估报告 |
| 获取评估报告 | GET | `/api/v2/rescue-workflow/evaluation/{event_id}/report` | 获取报告详情 |

### 7.2 接口详细设计

#### 7.2.1 生成评估报告

**POST** `/api/v2/rescue-workflow/evaluation/generate`

**请求体：**
```json
{
    "scenario_id": "scenario-uuid",
    "report_type": "comprehensive",
    "include_sections": ["response_time", "resource_utilization", "rescue_effectiveness", "ai_accuracy", "lessons_learned"]
}
```

**响应体：**
```json
{
    "success": true,
    "data": {
        "report_id": "report-uuid",
        "status": "generating",
        "estimated_completion_min": 5
    }
}
```

---

#### 7.2.2 获取评估报告

**GET** `/api/v2/rescue-workflow/evaluation/{event_id}/report`

**响应体：**
```json
{
    "success": true,
    "data": {
        "report_id": "report-uuid",
        "scenario_name": "茂县6.8级地震救援",
        "generated_at": "2025-11-26T10:00:00+08:00",
        "summary": {
            "overall_score": 87.5,
            "duration_hours": 72,
            "total_rescued": 145,
            "casualties": 12
        },
        "sections": {
            "response_time": {
                "score": 92,
                "first_response_min": 8,
                "full_deployment_min": 45,
                "benchmark_comparison": "优于标准15%"
            },
            "resource_utilization": {
                "score": 85,
                "teams_utilization": 0.92,
                "equipment_utilization": 0.78,
                "suggestions": ["部分检测设备未充分使用"]
            },
            "rescue_effectiveness": {
                "score": 88,
                "rescue_rate": 0.92,
                "average_rescue_time_min": 35
            },
            "ai_accuracy": {
                "score": 90,
                "event_detection_accuracy": 0.94,
                "scheme_adoption_rate": 0.85,
                "resource_match_accuracy": 0.88
            },
            "lessons_learned": [
                "无人机集群侦察效率高，建议增加配置",
                "通信中继需要加强，存在盲区",
                "AI方案建议基本合理，人工调整比例较低"
            ]
        },
        "recommendations": [
            "增加热成像无人机数量",
            "配置卫星通信中继设备",
            "优化AI资源匹配算法"
        ]
    }
}
```

---

## 八、阶段六：手册查询

### 8.1 接口列表

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 获取推荐手册 | GET | `/api/v2/rescue-workflow/manuals/{event_id}/recommendations` | 按事件推荐 |
| 搜索手册 | POST | `/api/v2/rescue-workflow/manuals/search` | 全文搜索 |

### 8.2 接口详细设计

#### 8.2.1 获取推荐手册

**GET** `/api/v2/rescue-workflow/manuals/{event_id}/recommendations`

**响应体：**
```json
{
    "success": true,
    "data": [
        {
            "id": "manual-uuid",
            "title": "建筑倒塌救援操作规程",
            "manual_type": "rescue_procedure",
            "relevance_score": 0.95,
            "summary": "适用于多层建筑倒塌的标准救援流程...",
            "steps_count": 12,
            "tags": ["建筑倒塌", "搜救", "生命探测"]
        }
    ]
}
```

---

#### 8.2.2 搜索手册

**POST** `/api/v2/rescue-workflow/manuals/search`

**请求体：**
```json
{
    "keyword": "液压破拆",
    "disaster_type": "earthquake",
    "limit": 10
}
```

**响应体：**
```json
{
    "success": true,
    "data": [
        {
            "id": "manual-uuid",
            "title": "液压破拆设备操作手册",
            "manual_type": "equipment_operation",
            "relevance_score": 0.88,
            "summary": "液压破拆工具的标准操作流程...",
            "tags": ["液压破拆", "设备操作"]
        }
    ]
}
```

---

## 九、错误码

| 错误码 | HTTP状态 | 说明 |
|-------|---------|------|
| OP4001 | 404 | 资源不存在 |
| OP4002 | 400 | 参数校验失败 |
| OP4003 | 409 | 状态不允许此操作 |
| OP4004 | 409 | 准备任务未全部完成 |
| OP4005 | 409 | 指挥所已建立 |
| OP4006 | 400 | 无人机集群配置错误 |
| OP4007 | 404 | 报告生成中或不存在 |
